import fs from 'fs'
import * as process from 'node:process'
import readline from 'readline'

export function writeToSummary(content: string) {
  const summaryFilePath = process.env.GITHUB_STEP_SUMMARY

  if (summaryFilePath == undefined) {
    console.log('Could not manually write to summary file')
    return
  }
  console.log('Trying to manually write to summary file: ', content)
  fs.appendFileSync(summaryFilePath, content)
}

class ProgressBar {
  total: number
  width: number
  current: number
  curNumRetries: number
  maxNumRetries: number

  constructor(total: number, maxNumRetries: number, width: number = 50) {
    this.total = total
    this.width = width
    this.current = 0
    this.curNumRetries = 1
    this.maxNumRetries = maxNumRetries
  }

  update(current: number) {
    this.current = current
    this.curNumRetries++
    this.render()
  }

  private render() {
    const progress = this.current / this.total
    const filledBarLength = Math.round(this.width * progress)
    const emptyBarLength = this.width - filledBarLength

    const filledBar = '█'.repeat(filledBarLength)
    const emptyBar = '░'.repeat(emptyBarLength)

    console.log(`Maximum Retries: [${filledBar}${emptyBar}] ${this.curNumRetries} of ${this.maxNumRetries}`)
  }
}

export default ProgressBar
