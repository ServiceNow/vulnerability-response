import fs from 'fs'
import * as process from 'node:process'
import readline from 'readline'

export function writeToSummary(content: string) {
  const summaryFilePath = process.env.GITHUB_STEP_SUMMARY

  if (summaryFilePath == undefined) {
    console.log('Could not manually write to summary file')
    return
  }
  console.log('Trying to manually write to summary file: ', content)
  fs.appendFileSync(summaryFilePath, content)
}

class ProgressBar {
  total: number
  width: number
  current: number

  constructor(total: number, width: number = 50) {
    this.total = total
    this.width = width
    this.current = 0
  }

  update(current: number) {
    this.current = current
    this.render()
  }

  private render() {
    const progress = this.current / this.total
    const filledBarLength = Math.round(this.width * progress)
    const emptyBarLength = this.width - filledBarLength

    const filledBar = '█'.repeat(filledBarLength)
    const emptyBar = '░'.repeat(emptyBarLength)

    readline.clearLine(process.stdout, 0)
    readline.cursorTo(process.stdout, 0)
    process.stdout.write(`Progress: [${filledBar}${emptyBar}] ${Math.round(progress * 100)}%`)
  }
}

export default ProgressBar
