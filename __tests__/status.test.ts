import { ActionInputsBuilder } from './utils'
import { generateStatusUrl, status } from '../src/api/status'
import { UploadApiResponseObject } from '../src/types/action'
import * as statusUtils from '../src/api/status'
import sinon, { createSandbox } from 'sinon'

const sandbox = createSandbox()
const BOM_RECORD_ID = 'sample-bom-record-id'

describe('Status', () => {
  let actionInputsBuilder = new ActionInputsBuilder()

  it('Should generate a URL with the correct search parameters', () => {
    let actionInputs = actionInputsBuilder.build()

    const statusUrl = generateStatusUrl(actionInputs, BOM_RECORD_ID)
    let expectedUrl = new URL('/api/sbom/core/upload/status', actionInputs.secrets.snInstanceUrl)
    let urlSearchParams = new URLSearchParams()
    urlSearchParams.append('bomRecordId', BOM_RECORD_ID)
    expectedUrl.search = urlSearchParams.toString()
    expect(statusUrl.href).toBe(expectedUrl.href)
  })
})
